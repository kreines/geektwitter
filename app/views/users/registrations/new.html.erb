<h2>Sign up</h2>

<%= form_for(resource, as: resource_name, url: registration_path(resource_name)) do |f| %>
  <%= render "users/shared/error_messages", resource: resource %>

  <div class="field">
    <%= f.label :name, "ユーザー名" %><br />
    <%= f.text_field :name, autofocus: true %>
  </div>

  <div class="field">
    <%= f.label :email, "メールアドレス" %><br />
    <%= f.email_field :email, autofocus: true, autocomplete: "email" %>
  </div>

<div class="field">
  <%= f.label :password, "パスワード" %>
  <% if @minimum_password_length %>
    <em>(<%= @minimum_password_length %> characters minimum)</em>
  <% end %><br />
  <%= f.text_field :password, autocomplete: "new-password" %>
</div>

<div class="field">
  <%= f.label :password_confirmation, "パスワード(確認)" %><br />
  <%= f.password_field :password_confirmation, autocomplete: "new-password" %>
</div>

<!-- 1. 一般 or クリエイター -->
<div data-controller="creator-fields">
  <div class="field">
    <%= f.label :role, "アカウントタイプ" %><br />
    <%= f.select :role,
                 [["一般", "general"], ["クリエイター", "creator"]],
                 prompt: "選択してください",
                 data: { "creator-fields-target": "role",
                         action: "creator-fields#toggle" } %>
  </div>

  <div class="field creator-fields"
       data-creator-fields-target="creatorFields"
       style="display:none;">
    <%= f.label :creator_type, "投稿タイプ" %><br />
    <%= f.select :creator_type, [["画像", "image"], ["動画", "video"], ["音楽", "music"]],
                 prompt: "選択してください" %>
  </div>

  <div class="field creator-fields"
       data-creator-fields-target="creatorFields"
       style="display:none;">
    <%= f.label :started_at, "活動を始めた年" %><br>
    <%= f.date_select :started_at,
                      discard_day: true, discard_month: true,
                      start_year: 1950, end_year: Date.today.year,
                      include_blank: "選択してください" %>
  </div>
</div>

  <div class="actions">
    <%= f.submit "登録" %>
  </div>
<% end %>

<%= render "users/shared/links" %>

<!-- JavaScript: クリエイター選択で追加フィールド表示 -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const roleSelect = document.querySelector("#user_role");
    const creatorFields = document.querySelectorAll(".creator-fields");

    roleSelect.addEventListener("change", () => {
      if (roleSelect.value === "creator") {
        creatorFields.forEach(f => f.style.display = "block");
      } else {
        creatorFields.forEach(f => f.style.display = "none");
      }
    });
  });
</script>

